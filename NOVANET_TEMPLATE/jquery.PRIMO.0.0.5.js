!function(e){function n(e){var n=null,t=jQuery(jQuery(".EXLResult")[e]);return t.index=e,t.id=t.find(".EXLResultRecordId[name]").attr("name"),t.title=t.find(".EXLResultTitle").text().trim(),t.openUrl=t.find(".EXLMoreTab a").attr("href"),t.tabs=o(t),t.materialType=function(){return a(t)},t.getIt1=function(){return i(t)},t.getDedupedRecordIds=function(){return r(t.id).data()},t.isRemoteRecord=function(){return"TN"===t.id.substring(0,2)},t.isOnEShelf=function(){return-1!=t.find(".EXLMyShelfStar a").attr("href").search("fn=remove")},t.getData=function(){if(!n){var e=y(t.id,"json");e&&e.length>0&&(n=e[0])}return n},t.getPNX=function(e){return y(t.id,e)},t}function t(e){return-1!=e.search(/^dedupmrg/)}function r(e){var n=[];return{data:function(){return 0===n.length&&t(e)&&jQuery.ajax({async:!1,type:"get",dataType:"json",data:{id:e},url:"/primo_library/libweb/dedup_records_helper.jsp"}).done(function(e){n=e}).fail(function(){console.log("You need the dedup_records_helper.jsp file")}),n}}}function a(e){return e.getData().display.type}function i(n){var t=n.tabs.getByName("ViewOnline"),r="";return t&&t.length>0&&(r=e(t.find('input[id*="getitonline1"]')).val().split("O4=")[1].split("O5=")[0].replace(/delivery,.*?,/,"")),r}function u(){return{by_record_id:function(n,t){if(void 0===n)throw"You must supply a record id";var r=void 0!==t?t.institution:jQuery.PRIMO.session.view.code,a=void 0!==t?t.index:1,i=void 0!==t?t.bulkSize:10,u=[];return jQuery.get("/PrimoWebServices/xservice/search/brief?institution="+r+"&query=rid,contains,"+n+"&indx="+a+"&bulkSize="+i).done(function(n){u=e(d(n))}).fail(function(){console.log("error searching")}),u},by_query:function(n,t){var r=void 0!==t?t.institution:jQuery.PRIMO.session.view.code,a=void 0!==t?t.index:1,i=void 0!==t?t.bulkSize:10;Array.isArray(n)?jQuery.each(n,function(e,t){n=0/0+t}):n="&query="+n;var u=[];return jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/PrimoWebServices/xservice/search/brief?institution="+r+"&indx="+a+"&bulkSize="+i+n}).done(function(n){u=e(d(n))}).fail(function(){console.log("error searching")}),u.length>0&&u[0].hasOwnProperty("JAGROOT")?u[0].JAGROOT.RESULT.DOCSET.DOC:(u.length>0&&u[0].hasOwnProperty("MESSAGE")&&console.log(u[0].MESSAGE),null)}}}function l(n,t){var r=null;if("number"==typeof t?r=n.find(".EXLResultTab")[t]:"string"==typeof t&&(r=n.find('.EXLResultTab:contains("'+t+'")'),(null==r||0==r.length)&&(r=e(n.tabs).find('a[title*="'+t+'"]').parent()),(null==r||0==r.length)&&(r=e(n).find('li[class*="'+t+'"]'))),null!==r){var a=jQuery(r).find("a").text().trim(),i=null;jQuery.each(a.toLowerCase().replace(/\s/g,"").split("&"),function(){c=n.find('*[class*="Container-'+this+'"]'),c.length>0&&(i=c)}),r.index=t,r.name=a,r.container=i,r.isOpen=function(){return jQuery(r).hasClass("EXLResultSelectedTab")},r.close=function(){jQuery.PRIMO.session.view.isFullDisplay||(n.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),n.find(".EXLTabsRibbon").addClass("EXLTabsRibbonClosed"),r.container.hide())},r.open=function(e,t){defaults={reload:!1,headerContent:"",url:"#"};var r=jQuery.extend(defaults,t);if(currentTab=n.tabs.getByName(a),n.find(".EXLTabsRibbonClosed").removeClass("EXLTabsRibbonClosed"),n.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),jQuery(currentTab).addClass("EXLResultSelectedTab"),n.find(".EXLResultTabContainer").hide(),currentTab.container.show(),!currentTab.container.data("loaded")||r.reload){var i='<div class="EXLTabHeaderContent">'+r.headerContent+'</div><div class="EXLTabHeaderButtons"><ul><li class="EXLTabHeaderButtonPopout"><span></span><a href="'+r.url+'" target="_blank"><img src="../images/icon_popout_tab.png" /></a></li><li></li><li class="EXLTabHeaderButtonCloseTabs"><a href="#" title="hide tabs"><img src="../images/icon_close_tabs.png" alt="hide tabs"></a></li></ul></div>',u='<div class="EXLTabHeader">'+i+"</div>",l='<div class="EXLTabContent">'+e+"</div>";currentTab.container.html(u+l),currentTab.container.data("loaded",!0)}}}return r}function o(e){var n=[],t=e.find(".EXLResultTab").length;for(k=0;t>k;k++)n.push(l(e,k));return null==n.addTab&&(n.addTab=function(n,t){t.record=e,s(n,t)}),n.getNames=function(){return tabNames=[],jQuery.each(n,function(){tabNames.push(this.name)}),tabNames},n.getEnabled=function(){return jQuery.map(e.find(".EXLResultTab"),function(e){return e=jQuery(e),"none"!=e.css("display")?jQuery(e).text().trim():null})},n.getByName=function(n){return l(e,n)},n}function s(e,n){defaults={record:null,state:"disabled",css:e.replace(" ","").toLowerCase()+"Tab",url:"#",url_target:"",tooltip:"",headerContent:"",click:function(){alert("To be implemented...")}};var t=jQuery.extend(defaults,n);if(jQuery.inArray(e,t.record.tabs.getNames())<0){var r='<li class="EXLResultTab '+t.css+'">';r+='  <span style="display:'+("disabled"==t.state?"block":"none")+'">'+e+"</span>",r+='  <a style="display:'+("disabled"==t.state?"none":"block")+'"',r+='     title="'+t.tooltip+'"',r+='     target="'+t.url_target+'"',r+='      href="'+t.url+'">'+e+"</a>",r+="</li>";var a='<div class="EXLResultTabContainer EXLContainer-'+t.css+'"></div>';t.record.find(".EXLResultTab").last().after(r),t.record.hasClass("EXLSummary")?t.record.append(a):t.record.find(".EXLSummary").append(a);var i="."+t.css+" a";null!==t.click&&t.record.find(i).click(function(n){n.preventDefault(),"enabled"==t.state&&(tab=t.record.tabs.getByName(e),t.click(n,tab,t.record,t))})}t.record.tabs=o(t.record)}function d(n,t){function r(n,u){if(!n)return null;{var l="",o=null,s=null;n.nodeType,a(n.localName||n.nodeName),n.text||n.nodeValue||""}n.childNodes&&n.childNodes.length>0&&e.each(n.childNodes,function(e,n){var t=n.nodeType,u=a(n.localName||n.nodeName),s=n.text||n.nodeValue||"";if(8!=t)if(3!=t&&4!=t&&u)o=o||{},o[u]?(o[u].length||(o[u]=i(o[u])),o[u]=i(o[u]),o[u][o[u].length]=r(n,!0),o[u].length=o[u].length):o[u]=r(n);else{if(s.match(/^\s+$/))return;l+=s.replace(/^\s+/,"").replace(/\s+$/,"")}}),n.attributes&&n.attributes.length>0&&(s={},o=o||{},e.each(n.attributes,function(e,n){var t=a(n.name),r=n.value;s[t]=r,o[t]?(o[cnn]=i(o[cnn]),o[t][o[t].length]=r,o[t].length=o[t].length):o[t]=r})),o&&(o=e.extend(""!=l?new String(l):{},o||{}),l=o.text?[o.text||""].concat([l]):l,l&&(o.text=l),l="");var d=o||l;return t&&(l&&(d={}),l=d.text||l||"",l&&(d.text=l),u||(d=i(d))),d}if(!n)return{};var a=function(e){return String(e||"").replace(/-/g,"_")},i=function(n){return e.isArray(n)||(n=[n]),n.length=n.length,n};if("string"==typeof n&&(n=f(n)),n.nodeType){if(3==n.nodeType||4==n.nodeType)return n.nodeValue;var u=9==n.nodeType?n.documentElement:n,l=r(u,!0);return n=null,u=null,l}}function f(n){return e.parseXML(n)}function b(e){var n;return n=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}var y=function(n,t){var r=null;return void 0===t&&(t="text"),jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/primo_library/libweb/action/display.do?vid="+jQuery.PRIMO.session.view.code+"&showPnx=true&pds_handle=GUEST&doc="+n,success:function(n,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(t){case"text":r=b(n);break;case"json":r=e(d(n));break;default:r=e(n)}else alert("PDS redirect detected. Do not know how to handle that, yet.")}}),e.isArray(r)?r[0]:r},p=function(){var n=null;return{data:function(){return n?void 0:(n={},jQuery.ajax({async:!1,type:"get",dataType:"json",url:"/primo_library/libweb/remote_session_data_helper.jsp"}).done(function(e){n=jQuery.extend(!0,{},e),n.user.isLoggedIn=function(){return e.user.isLoggedIn},n.user.isOnCampus=function(){return e.user.isOnCampus}}).fail(function(){n={view:{code:e("#vid").val()},user:{id:g.data().id,name:g.data().name,isLoggedIn:function(){return g.data().loggedIn}}}}),e.extend(n.view,{isFullDisplay:function(){return window.isFullDisplay()},frontEndID:function(){return h.data()}()}),n)}}}(),g=function(){var n=null;return{data:function(){return n||(n={},jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/primo_library/libweb/getUserInfoServlet",success:function(t){n.id=e(t).find("userId").text(),n.name=e(t).find("userName").text(),n.loggedIn="true"===e(t).find("isLoggedIn").text()}})),n}}}(),h=function(){var e=null;return{data:function(){return e||(e="unknown",jQuery.ajax({async:!1,type:"get",url:"/primo_library/libweb/static_htmls/header.html",complete:function(n){e=n.getResponseHeader("X-PRIMO-FE-ENVIRONMENT")}})),e}}}();jQuery.PRIMO={session:function(){return p.data()}(),records:function(){for(var t=jQuery(".EXLResult").length,r=[],a=0;t>a;a++)r.push(n(a));return e(r)}(),search:u(),version:"0.0.5"}}(jQuery);